generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model log_request {
  id               Int      @id @default(autoincrement())
  ref_id           String   @db.VarChar(50)
  user_ref_id      String?  @db.VarChar(50)
  provider         String?  @db.VarChar(25)
  method           String   @db.VarChar(10)
  intent           String   @db.VarChar(255)
  path             String   @db.VarChar(500)
  payload          Json
  api_endpoint     String   @db.Text
  response         Json
  status_code      Int
  trace            Json
  started_at       DateTime @default(now()) @db.DateTime(0)
  completed_at     DateTime @default(now()) @db.DateTime(0)
  client_ip        String   @db.VarChar(255)
  client_headers   Json
  response_headers Json
  is_error         Boolean? @default(false)
  error            Json?
  via_provider     String?  @db.VarChar(25)
  service_type     String?  @db.VarChar(25)
  created_at       DateTime @default(now()) @db.DateTime(0)
  updated_at       DateTime @default(now()) @db.DateTime(0)

  @@index([provider], map: "provider_idx")
  @@index([ref_id], map: "ref_idx")
  @@index([user_ref_id], map: "user_ref_idx")
}

model providers {
  id                  Int      @id @default(autoincrement())
  ref_id              String?  @db.VarChar(50)
  provider_identifier String   @db.VarChar(50)
  provider_name       String   @db.VarChar(50)
  category            String?  @db.VarChar(50)
  auth_type           String?  @db.VarChar(20)
  auth_config         Json?
  fields              Json?
  presets             Json?
  description         String?  @db.Text
  status              String?  @db.VarChar(255)
  active              Int      @default(1) @db.TinyInt
  hidden              Int      @default(0) @db.TinyInt
  image_url           String?  @db.Text
  created_at          DateTime @default(now()) @db.DateTime(0)
  updated_at          DateTime @default(now()) @db.DateTime(0)

  @@index([ref_id], map: "ref_idx")
}

model providers_credential_and_tokens {
  id             Int      @id @default(autoincrement())
  user_ref_id    String?  @db.VarChar(50)
  provider       String   @db.VarChar(20)
  auth_type      String   @db.VarChar(20)
  config         Json?
  provider_data  Json?
  credentials    Json?
  active         Boolean? @default(true)
  descriptions   String?  @db.Text
  remark         String?  @db.Text
  provider_error Json?
  created_at     DateTime @default(now()) @db.DateTime(0)
  updated_at     DateTime @default(now()) @db.DateTime(0)

  @@index([provider], map: "provider_idx")
  @@index([user_ref_id], map: "user_ref_idx")
}

model providers_intent_default_payloads {
  id              Int      @id @default(autoincrement())
  ref_id          String   @db.VarChar(50)
  intent_ref_id   String?  @db.VarChar(50)
  title           String?  @db.Text
  description     String?  @db.Text
  method          String?  @db.VarChar(10)
  query_params    Json?
  path_params     Json?
  body            Json?
  custom_headers  Json?
  response_format Json?
  status          String?  @db.VarChar(10)
  active          Int      @default(0) @db.TinyInt
  created_at      DateTime @default(now()) @db.DateTime(0)
  updated_at      DateTime @default(now()) @db.DateTime(0)

  @@index([intent_ref_id], map: "intent_ref_idx")
  @@index([method], map: "method_idx")
  @@index([ref_id], map: "ref_idx")
}

model providers_intents {
  id                    Int      @id @default(autoincrement())
  ref_id                String   @db.VarChar(50)
  provider_id           String?  @db.VarChar(50)
  text                  String?  @db.Text
  provider_intent       String?  @db.Text
  provider_alias_intent String?  @db.Text
  category              String?  @db.Text
  type                  String?  @db.VarChar(10)
  request_type          String?  @db.VarChar(25)
  method                String?  @db.VarChar(10)
  params                Json?
  path_params           Json?
  body                  Json?
  custom_headers        Json?
  domain_params         Json?
  meta                  Json?
  auth                  Json?
  response_format       Json?
  status                String?  @db.VarChar(10)
  active                Int      @default(0) @db.TinyInt
  created_at            DateTime @default(now()) @db.DateTime(0)
  updated_at            DateTime @default(now()) @db.DateTime(0)

  @@index([category(length: 50)], map: "category_idx")
  @@index([method], map: "method_idx")
  @@index([provider_id], map: "provider_id_idx")
  @@index([ref_id], map: "ref_idx")
}

model providers_oauth_credentials {
  id           Int      @id @default(autoincrement())
  user_ref_id  String?  @db.VarChar(50)
  provider     String   @db.VarChar(20)
  auth_type    String   @db.VarChar(20)
  credentials  Json?
  active       Boolean? @default(true)
  descriptions String?  @db.Text
  created_at   DateTime @default(now()) @db.DateTime(0)
  updated_at   DateTime @default(now()) @db.DateTime(0)

  @@index([provider], map: "provider_idx")
  @@index([user_ref_id], map: "user_ref_idx")
}

model users {
  id              Int       @id @default(autoincrement())
  ref_id          String?   @db.VarChar(255)
  entity_id       Int?
  email           String    @unique(map: "email") @db.VarChar(255)
  username        String?   @db.VarChar(255)
  company_name    String?   @db.VarChar(255)
  phone           String?   @db.VarChar(255)
  first_name      String?   @db.VarChar(255)
  middle_name     String?   @db.VarChar(255)
  last_name       String?   @db.VarChar(255)
  profile_picture String?   @db.VarChar(255)
  avatars         Json?
  gender          String?   @db.VarChar(255)
  password_hash   String?   @db.VarChar(255)
  user_token      String?   @db.VarChar(255)
  email_verified  Boolean   @default(false)
  service_limit   Int?      @default(2)
  cache_duration  Int?      @default(120)
  full_access     Boolean   @default(false)
  billing_enabled Boolean   @default(false)
  country_code    String    @default("") @db.VarChar(2)
  extra           Json?
  export_user     Boolean?
  active          Boolean   @default(false)
  login_at        DateTime? @db.DateTime(0)
  last_login_at   DateTime? @db.DateTime(0)
  created_at      DateTime  @db.DateTime(0)
  updated_at      DateTime  @db.DateTime(0)

  @@index([ref_id], map: "ref_idx")
}

model users_activated_providers {
  id              Int      @id @default(autoincrement())
  ref_id          String?  @db.VarChar(50)
  user_ref_id     String   @db.VarChar(50)
  provider_ref_id String   @db.VarChar(50)
  active          Int      @default(1) @db.TinyInt
  created_at      DateTime @default(now()) @db.DateTime(0)
  updated_at      DateTime @default(now()) @db.DateTime(0)

  @@index([provider_ref_id], map: "provider_ref_id")
  @@index([ref_id], map: "ref_idx")
  @@index([user_ref_id], map: "user_ref_id")
}

model users_api_tokens {
  id                  Int       @id @default(autoincrement())
  ref_id              String    @db.VarChar(255)
  user_ref_id         String    @db.VarChar(255)
  api_token           String    @db.VarChar(255)
  api_token_credits   Int?      @default(500)
  api_credit_consumed Int?      @default(0)
  last_used           DateTime? @db.DateTime(0)
  api_token_expiry    Int?      @default(90)
  api_token_config    Json?
  remark              String?   @db.Text
  active              Boolean   @default(false)
  created_at          DateTime  @db.DateTime(0)
  updated_at          DateTime  @db.DateTime(0)

  @@index([ref_id], map: "ref_idx")
  @@index([user_ref_id], map: "user_ref_idx")
}

model users_providers_intent_hydration {
  id           Int      @id @default(autoincrement())
  user_ref_id  String   @db.VarChar(50)
  name         String   @db.VarChar(100)
  provider     String   @db.VarChar(25)
  method       String   @db.VarChar(10)
  intent       String   @db.VarChar(255)
  body         Json?
  query_params Json?
  path_params  Json?
  headers      Json?
  created_at   DateTime @default(now()) @db.DateTime(0)
  updated_at   DateTime @default(now()) @db.DateTime(0)

  @@index([provider], map: "provider_idx")
  @@index([user_ref_id], map: "user_ref_idx")
  @@index([intent], map: "users_providers_intent_hydration_idx")
}

model users_providers_saved_intents {
  id          Int      @id @default(autoincrement())
  user_ref_id String   @db.VarChar(50)
  provider    String   @db.VarChar(25)
  method      String   @db.VarChar(10)
  intent      String   @db.VarChar(255)
  path        String   @db.VarChar(255)
  saved_mode  String   @default("fav") @db.VarChar(10)
  created_at  DateTime @default(now()) @db.DateTime(0)
  updated_at  DateTime @default(now()) @db.DateTime(0)

  @@index([provider], map: "provider_idx")
  @@index([user_ref_id], map: "user_ref_idx")
  @@index([intent], map: "users_saved_intent_idx")
}

model users_unified_config {
  id           Int       @id @default(autoincrement())
  ref_id       String?   @db.VarChar(255)
  user_ref_id  String    @db.VarChar(255)
  unified_type String    @db.VarChar(255)
  provider     String?   @db.VarChar(255)
  json_config  Json?
  remark       String?   @db.Text
  active       Boolean?  @default(false)
  created_at   DateTime? @default(now()) @db.Timestamp(0)
  updated_at   DateTime? @default(now()) @db.Timestamp(0)

  @@unique([user_ref_id, unified_type], map: "fk_users_unified_config_idx")
  @@index([ref_id], map: "ref_idx")
  @@index([unified_type], map: "unified_type_idx")
  @@index([user_ref_id], map: "user_ref_idx")
}
